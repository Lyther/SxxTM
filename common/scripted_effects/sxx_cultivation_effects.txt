sxx_pop_break_to_lianqi = {
	set_pop_flag = sxx_lianqi set_variable = { which = sxx_pop_state value = 1 }
	modify_species = {
		species = this
		add_trait = trait_sxx_lianqi
	}
	set_variable = { which = sxx_pop_xp value = 0 }
	owner = {
		if = {
			limit = {
				is_sxx_lianqi_country = no
			}
			set_country_flag = sxx_country_break_to_lianqi
		}
		if = {
			limit = {
				has_event_chain = sxx_cultivation_data_chain
			}
			add_event_chain_counter = {
				event_chain = sxx_cultivation_data_chain
				counter = sxx_mortal_broke_count
				amount = 1
			}
		}
		sxx_add_task_counter = { TASK = 1 }
	}
}

sxx_pop_break_to_zhuji = {
	remove_pop_flag = sxx_lianqi
	set_pop_flag = sxx_zhuji set_variable = { which = sxx_pop_state value = 2 }
	modify_species = {
		species = this
		remove_trait = trait_sxx_lianqi
		add_trait = trait_sxx_zhuji
	}
	set_variable = { which = sxx_pop_xp value = 0 }
	owner = {
		if = {
			limit = {
				is_sxx_zhuji_country = no
			}
			set_country_flag = sxx_country_break_to_zhuji
		}
		if = {
			limit = {
				has_event_chain = sxx_cultivation_data_chain
			}
			add_event_chain_counter = {
				event_chain = sxx_cultivation_data_chain
				counter = sxx_lianqi_broke_count
				amount = 1
			}
		}
		sxx_add_task_counter = { TASK = 2 }
	}
}

sxx_pop_break_to_jindan = {
	remove_pop_flag = sxx_zhuji
	set_pop_flag = sxx_jindan set_variable = { which = sxx_pop_state value = 3 }
	modify_species = {
		species = this
		remove_trait = trait_sxx_zhuji
		add_trait = trait_sxx_jindan
	}
	set_variable = { which = sxx_pop_xp value = 0 }
	owner = {
		if = {
			limit = {
				is_sxx_jindan_country = no
			}
			set_country_flag = sxx_country_break_to_jindan
		}
		if = {
			limit = {
				has_event_chain = sxx_cultivation_data_chain
			}
			add_event_chain_counter = {
				event_chain = sxx_cultivation_data_chain
				counter = sxx_zhuji_broke_count
				amount = 1
			}
		}
		sxx_add_task_counter = { TASK = 3 }
	}
}

sxx_pop_break_to_yuanying = {
	remove_pop_flag = sxx_jindan
	set_pop_flag = sxx_yuanying set_variable = { which = sxx_pop_state value = 4 }
	modify_species = {
		species = this
		remove_trait = trait_sxx_jindan
		add_trait = trait_sxx_yuanying
	}
	set_variable = { which = sxx_pop_xp value = 0 }
	owner = {
		if = {
			limit = {
				is_sxx_yuanying_country = no
			}
			set_country_flag = sxx_country_break_to_yuanying
		}
		if = {
			limit = {
				has_event_chain = sxx_cultivation_data_chain
			}
			add_event_chain_counter = {
				event_chain = sxx_cultivation_data_chain
				counter = sxx_jindan_broke_count
				amount = 1
			}
		}
		sxx_add_task_counter = { TASK = 4 }
	}
}

sxx_pop_break_to_huashen = {
	remove_pop_flag = sxx_yuanying
	set_pop_flag = sxx_huashen set_variable = { which = sxx_pop_state value = 5 }
	modify_species = {
		species = this
		remove_trait = trait_sxx_yuanying
		add_trait = trait_sxx_huashen
	}
	set_variable = { which = sxx_pop_xp value = 0 }
	owner = {
		if = {
			limit = {
				is_sxx_huashen_country = no
			}
			set_country_flag = sxx_country_break_to_huashen
		}
		if = {
			limit = {
				has_event_chain = sxx_cultivation_data_chain
			}
			add_event_chain_counter = {
				event_chain = sxx_cultivation_data_chain
				counter = sxx_yuanying_broke_count
				amount = 1
			}
		}
		sxx_add_task_counter = { TASK = 5 }
	}
}

sxx_pop_break_to_lianxu = {
	remove_pop_flag = sxx_huashen
	set_pop_flag = sxx_lianxu set_variable = { which = sxx_pop_state value = 6 }
	modify_species = {
		species = this
		remove_trait = trait_sxx_huashen
		add_trait = trait_sxx_lianxu
	}
	set_variable = { which = sxx_pop_xp value = 0 }
	owner = {
		if = {
			limit = {
				is_sxx_lianxu_country = no
			}
			set_country_flag = sxx_country_break_to_lianxu
		}
		if = {
			limit = {
				has_event_chain = sxx_cultivation_data_chain
			}
			add_event_chain_counter = {
				event_chain = sxx_cultivation_data_chain
				counter = sxx_huashen_broke_count
				amount = 1
			}
		}
		sxx_add_task_counter = { TASK = 6 }
	}
}

sxx_pop_break_to_heti = {
	remove_pop_flag = sxx_lianxu
	set_pop_flag = sxx_heti set_variable = { which = sxx_pop_state value = 7 }
	modify_species = {
		species = this
		remove_trait = trait_sxx_lianxu
		add_trait = trait_sxx_heti
	}
	set_variable = { which = sxx_pop_xp value = 0 }
	owner = {
		if = {
			limit = {
				is_sxx_heti_country = no
			}
			set_country_flag = sxx_country_break_to_heti
		}
		if = {
			limit = {
				has_event_chain = sxx_cultivation_data_chain
			}
			add_event_chain_counter = {
				event_chain = sxx_cultivation_data_chain
				counter = sxx_lianxu_broke_count
				amount = 1
			}
		}
		sxx_add_task_counter = { TASK = 7 }
	}
}

sxx_pop_break_to_dacheng = {
	remove_pop_flag = sxx_heti
	set_pop_flag = sxx_dacheng set_variable = { which = sxx_pop_state value = 8 }
	modify_species = {
		species = this
		remove_trait = trait_sxx_heti
		add_trait = trait_sxx_dacheng
	}
	set_variable = { which = sxx_pop_xp value = 0 }
	owner = {
		if = {
			limit = {
				is_sxx_dacheng_country = no
			}
			set_country_flag = sxx_country_break_to_dacheng
		}
		if = {
			limit = {
				has_event_chain = sxx_cultivation_data_chain
			}
			add_event_chain_counter = {
				event_chain = sxx_cultivation_data_chain
				counter = sxx_heti_broke_count
				amount = 1
			}
		}
		sxx_add_task_counter = { TASK = 8 }
	}
	if = {
		limit = {
			owner = {
				has_origin = origin_sxx_yuhua
				NOT = { has_country_flag = synthetic_empire }
			}
			has_trait = trait_sxx_linggen
		}
		sxx_pop_die_and_become_yuhuaxian_if_possible = yes
	}
}

sxx_pop_break_to_dujie = {
	if = {
		limit = {
			NOT = { has_trait = trait_sxx_linggen }
		}
		remove_pop_flag = sxx_dacheng
		set_pop_flag = sxx_dujie set_variable = { which = sxx_pop_state value = 9 }
		modify_species = {
			species = this
			remove_trait = trait_sxx_dacheng
			add_trait = trait_sxx_dujie
		}
		set_variable = { which = sxx_pop_xp value = 0 }
		owner = {
			if = {
				limit = {
					is_sxx_dujie_country = no
				}
				set_country_flag = sxx_country_break_to_dujie
			}
			if = {
				limit = {
					has_event_chain = sxx_cultivation_data_chain
				}
				add_event_chain_counter = {
					event_chain = sxx_cultivation_data_chain
					counter = sxx_dacheng_broke_count
					amount = 1
				}
			}
			sxx_add_task_counter = { TASK = 9 }
		}
	}
	else = {
		sxx_pop_become_zombie_or_be_killed = yes # 不是 sxx_pop_die_and_become_yuhuaxian_if_possible
	}
}

sxx_pop_break_to_fairy = {
	if = {
		limit = {
			owner = { has_ascension_perk = ap_sxx_ascend_to_fairyland }
		}
		owner = {
			change_variable = { which = value_sxx_fairy_1 value = 1 }
			add_resource = { sxx_qiyun = 100 }
			if = {
				limit = {
					is_sxx_fairy_country = no
				}
				set_country_flag = sxx_country_break_to_fairy
			}
			else = {
				add_event_chain_counter = {
					event_chain = sxx_ascend_chain
					counter = sxx_fairy_1
					amount = 1
				}
				country_event = { id = sxx_fairy.210 }
			}
	
			if = {
				limit = {
					has_event_chain = sxx_cultivation_data_chain
				}
				add_event_chain_counter = {
					event_chain = sxx_cultivation_data_chain
					counter = sxx_dujie_broke_count
					amount = 1
				}
			}
			sxx_add_task_counter = { TASK = 10 }
		}
		if = {
			limit = {
				has_modifier = sxx_leader_pop_modifier
			}
			if = {
				limit = {
					owner = {
						any_owned_leader = {
							prevprev = { has_pop_flag = sxx_leader_pop_of@prev }
						}
					}
				}
				owner = {
					random_owned_leader = {
						limit = {
							prevprev = { has_pop_flag = sxx_leader_pop_of@prev }
						}
						add_trait = leader_trait_sxx_to_fairy
					}
				}

			}
		}
		if = {
			limit = {
				is_sxx_fairy_reborn_body = yes
			}
			owner = { country_event = { id = sxx_fairy.505 days = 1 } }
		}
		kill_pop = yes
	}
	else_if = {
		limit = {
			owner = { has_ascension_perk = ap_sxx_build_heaven }
		}
		remove_pop_flag = sxx_dujie
		set_pop_flag = sxx_zhenxian set_variable = { which = sxx_pop_state value = 10 }
		modify_species = {
			species = this
			remove_trait = trait_sxx_dujie
			add_trait = trait_sxx_zhenxian
		}
		set_variable = { which = sxx_pop_xp value = 0 }
		sxx_pop_remove_potential_depletion = yes
		owner = {
			if = {
				limit = {
					is_sxx_heaven_country = no
				}
				set_country_flag = sxx_country_break_to_heaven
			}
			else = {
				country_event = { id = sxx_fairy.110 }
			}
			if = {
				limit = {
					has_event_chain = sxx_cultivation_data_chain
				}
				add_event_chain_counter = {
					event_chain = sxx_cultivation_data_chain
					counter = sxx_dujie_broke_count
					amount = 1
				}
			}
			sxx_add_task_counter = { TASK = 10 }
		}
	}
}

sxx_pop_break_to_xianwang = {
	remove_pop_flag = sxx_zhenxian
	set_pop_flag = sxx_xianwang set_variable = { which = sxx_pop_state value = 11 }
	modify_species = {
		species = this
		remove_trait = trait_sxx_zhenxian
		add_trait = trait_sxx_xianwang
	}
	set_variable = { which = sxx_fairy_pop_xp value = 0 }
	owner = {
		change_variable = { which = num_sxx_xianwang value = 1 }
		if = {
			limit = {
				owner = {
					check_variable = { 	which = num_sxx_xianwang value < 4 }
				}
			}
			country_event = { id = sxx_fairy.120 }
		}
	}
}

sxx_pop_break_to_xiandi = {
	remove_pop_flag = sxx_xianwang
	set_pop_flag = sxx_xiandi set_variable = { which = sxx_pop_state value = 12 }
	modify_species = {
		species = this
		remove_trait = trait_sxx_xianwang
		add_trait = trait_sxx_xiandi
	}
	set_variable = { which = sxx_fairy_pop_xp value = 0 }
	owner = {
		change_variable = { which = num_sxx_xiandi value = 1 }
		if = {
			limit = {
				owner = {
					check_variable = { 	which = num_sxx_xiandi value < 1 }
				}
			}
			country_event = { id = sxx_fairy.130 }
		}
	}
}

sxx_pop_may_break_from_cultivation_by_state = {
	random_list = {
		90 = {
			modifier = {
				factor = 0
				is_sxx_potential_depletion = no
			}
		}
		10 = {
			switch = {
				trigger = has_pop_flag
				sxx_lianqi = {
					sxx_pop_break_to_zhuji = yes
				}
				sxx_zhuji = {
					random_list = {
						90 = { sxx_pop_break_to_jindan = yes }
						10 = {}
					}
				}
				sxx_jindan = {
					random_list = {
						80 = { sxx_pop_break_to_yuanying = yes }
						20 = {}
					}
				}
				sxx_yuanying = {
					random_list = {
						70 = { sxx_pop_break_to_huashen = yes }
						30 = {}
					}
				}
				sxx_huashen = {
					random_list = {
						60 = { sxx_pop_break_to_lianxu = yes }
						40 = {}
					}
				}
				sxx_lianxu = {
					random_list = {
						50 = { sxx_pop_break_to_heti = yes }
						50 = {}
					}
				}
				sxx_heti = {
					random_list = {
						40 = { sxx_pop_break_to_dacheng = yes }
						60 = {}
					}
				}
				sxx_dacheng = {
					random_list = {
						30 = { sxx_pop_break_to_dujie = yes }
						70 = {}
					}
				}
				sxx_dujie = {
					random_list = {
						20 = { sxx_pop_break_to_fairy = yes }
						80 = {}
					}
				}
			}
		}
	}
}

sxx_fairy_pop_may_break_from_cultivation_by_state = {
	switch = {
		trigger = has_pop_flag
		sxx_zhenxian = {
			random_list = {
				20 = {}
				10 = { sxx_pop_break_to_xianwang = yes }
			}
		}
		sxx_xianwang = {
			random_list = {
				90 = {}
				10 = { sxx_pop_break_to_xiandi = yes }
			}
		}
	}
}

sxx_pop_may_pd_from_cultivation = {
	if = {
		limit = {
			is_sxx_t1_body = yes
		}
		# nothing
	}
	else_if = {
		limit = {
			is_sxx_t2_body = yes
		}
		random_list = {
			90 = {}
			10 = { sxx_pop_set_potential_depletion = yes }
		}
	}
	else = {
		sxx_pop_set_potential_depletion = yes
	}
}

sxx_pop_may_pd_from_cultivation_by_state = {
	switch = {
		trigger = has_pop_flag
		sxx_lianqi = {
			random_list = {
				10 = { sxx_pop_may_pd_from_cultivation = yes }
				2550 = {}
			}
		}
		sxx_zhuji = {
			random_list = {
				10 = { sxx_pop_may_pd_from_cultivation = yes }
				1270 = {}
			}
		}
		sxx_jindan = {
			random_list = {
				10 = { sxx_pop_may_pd_from_cultivation = yes }
				630 = {}
			}
		}
		sxx_yuanying = {
			random_list = {
				10 = { sxx_pop_may_pd_from_cultivation = yes }
				310 = {}
			}
		}
		sxx_huashen = {
			random_list = {
				10 = { sxx_pop_may_pd_from_cultivation = yes }
				150 = {}
			}
		}
		sxx_lianxu = {
			random_list = {
				10 = { sxx_pop_may_pd_from_cultivation = yes }
				70 = {}
			}
		}
		sxx_heti = {
			random_list = {
				10 = { sxx_pop_may_pd_from_cultivation = yes }
				30 = {}
			}
		}
		sxx_dacheng = {
			random_list = {
				10 = { sxx_pop_may_pd_from_cultivation = yes }
				10 = {}
			}
		}
		sxx_dujie = { sxx_pop_may_pd_from_cultivation = yes }
	}
}

sxx_pop_die_from_cultivation_effect = {
	sxx_pop_add_died_data = yes
	sxx_pop_die_and_become_yuhuaxian_if_possible = yes
}

sxx_pop_may_die_from_cultivation = {
	if = {
		limit = {
			is_sxx_t1_body = yes
		}
		# nothing
	}
	else_if = {
		limit = {
			is_sxx_t2_body = yes
		}
		random_list = {
			90 = {}
			10 = {
				sxx_pop_add_died_data = yes
				sxx_pop_die_and_become_yuhuaxian_if_possible = yes
			}
		}
	}
	else = {
		sxx_pop_add_died_data = yes
		sxx_pop_die_and_become_yuhuaxian_if_possible = yes
	}
}

sxx_pop_may_die_from_cultivation_by_state = {
	switch = {
		trigger = has_pop_flag
		sxx_yuanying = {
			random_list = {
				10 = { sxx_pop_may_die_from_cultivation = yes }
				310 = {}
			}
		}
		sxx_huashen = {
			random_list = {
				10 = { sxx_pop_may_die_from_cultivation = yes }
				150 = {}
			}
		}
		sxx_lianxu = {
			random_list = {
				10 = { sxx_pop_may_die_from_cultivation = yes }
				70 = {}
			}
		}
		sxx_heti = {
			random_list = {
				10 = { sxx_pop_may_die_from_cultivation = yes }
				30 = {}
			}
		}
		sxx_dacheng = {
			random_list = {
				10 = { sxx_pop_may_die_from_cultivation = yes }
				10 = {}
			}
		}
		sxx_dujie = { sxx_pop_may_die_from_cultivation = yes }
	}
}

sxx_pop_add_died_data = {
	if = {
		limit = {
			exists = owner
			owner = { is_ai = yes }
		}
		switch = {
			trigger = has_pop_flag
			sxx_lianqi = {
				owner = {
					if = {
						limit = {
							has_event_chain = sxx_cultivation_data_chain
						}
						add_event_chain_counter = {
							event_chain = sxx_cultivation_data_chain
							counter = sxx_lianqi_died_count
							amount = 1
						}
					}
				}
			}
			sxx_zhuji = {
				owner = {
					if = {
						limit = {
							has_event_chain = sxx_cultivation_data_chain
						}
						add_event_chain_counter = {
							event_chain = sxx_cultivation_data_chain
							counter = sxx_zhuji_died_count
							amount = 1
						}
					}
				}
			}
			sxx_jindan = {
				owner = {
					if = {
						limit = {
							has_event_chain = sxx_cultivation_data_chain
						}
						add_event_chain_counter = {
							event_chain = sxx_cultivation_data_chain
							counter = sxx_jindan_died_count
							amount = 1
						}
					}
				}
			}
			sxx_yuanying = {
				owner = {
					if = {
						limit = {
							has_event_chain = sxx_cultivation_data_chain
						}
						add_event_chain_counter = {
							event_chain = sxx_cultivation_data_chain
							counter = sxx_yuanying_died_count
							amount = 1
						}
					}
				}
			}
			sxx_huashen = {
				owner = {
					if = {
						limit = {
							has_event_chain = sxx_cultivation_data_chain
						}
						add_event_chain_counter = {
							event_chain = sxx_cultivation_data_chain
							counter = sxx_huashen_died_count
							amount = 1
						}
					}
				}
			}
			sxx_lianxu = {
				owner = {
					if = {
						limit = {
							has_event_chain = sxx_cultivation_data_chain
						}
						add_event_chain_counter = {
							event_chain = sxx_cultivation_data_chain
							counter = sxx_lianxu_died_count
							amount = 1
						}
					}
				}
			}
			sxx_heti = {
				owner = {
					if = {
						limit = {
							has_event_chain = sxx_cultivation_data_chain
						}
						add_event_chain_counter = {
							event_chain = sxx_cultivation_data_chain
							counter = sxx_heti_died_count
							amount = 1
						}
					}
				}
			}
			sxx_dacheng = {
				owner = {
					if = {
						limit = {
							has_event_chain = sxx_cultivation_data_chain
						}
						add_event_chain_counter = {
							event_chain = sxx_cultivation_data_chain
							counter = sxx_dacheng_died_count
							amount = 1
						}
					}
				}
			}
			sxx_dujie = {
				owner = {
					if = {
						limit = {
							has_event_chain = sxx_cultivation_data_chain
						}
						add_event_chain_counter = {
							event_chain = sxx_cultivation_data_chain
							counter = sxx_dujie_died_count
							amount = 1
						}
					}
				}
			}
		}
	}
}

sxx_set_pop_xp_max_if_over_max = {
	if = {
		limit = {
			check_variable = {
				which = sxx_pop_xp
				value > value:sxx_pop_xp_max
			}
		}
		set_variable = { which = sxx_pop_xp value = value:sxx_pop_xp_max }
	}
}

sxx_set_fairy_pop_xp_max_if_over_max = {
	if = {
		limit = {
			check_variable = {
				which = sxx_fairy_pop_xp
				value > value:sxx_fairy_pop_xp_max
			}
		}
		set_variable = { which = sxx_fairy_pop_xp value = value:sxx_fairy_pop_xp_max }
	}
}

sxx_pop_random_get_xp = {
	random_list = {
		5000 = { change_variable = { which = sxx_pop_xp value = value:sxx_pop_xp_get_t1 } } # 0.1倍经验
		20000 = { change_variable = { which = sxx_pop_xp value = value:sxx_pop_xp_get_t2 } } # 0.5倍经验
		50000 = { change_variable = { which = sxx_pop_xp value = value:sxx_pop_xp_get_t3 } } # 1倍经验
		20000 = { change_variable = { which = sxx_pop_xp value = value:sxx_pop_xp_get_t4 } } # 1.5倍经验
		4000 = { change_variable = { which = sxx_pop_xp value = value:sxx_pop_xp_get_t5 } } # 2倍经验
		750 = { change_variable = { which = sxx_pop_xp value = value:sxx_pop_xp_get_t6 } } # 5倍经验
		225 = { change_variable = { which = sxx_pop_xp value = value:sxx_pop_xp_get_t7 } } # 10倍经验
		20 = { change_variable = { which = sxx_pop_xp value = value:sxx_pop_xp_get_t8 } } # 50倍经验
		5 = { change_variable = { which = sxx_pop_xp value = value:sxx_pop_xp_get_t9 } } # 100倍经验
	}
	sxx_set_pop_xp_max_if_over_max = yes
}

sxx_fairy_pop_random_get_xp = {
	random_list = {
		5000 = { change_variable = { which = sxx_fairy_pop_xp value = value:sxx_fairy_pop_xp_get_t1 } } # 0.1倍经验
		20000 = { change_variable = { which = sxx_fairy_pop_xp value = value:sxx_fairy_pop_xp_get_t2 } } # 0.5倍经验
		50000 = { change_variable = { which = sxx_fairy_pop_xp value = value:sxx_fairy_pop_xp_get_t3 } } # 1倍经验
		20000 = { change_variable = { which = sxx_fairy_pop_xp value = value:sxx_fairy_pop_xp_get_t4 } } # 1.5倍经验
		4000 = { change_variable = { which = sxx_fairy_pop_xp value = value:sxx_fairy_pop_xp_get_t5 } } # 2倍经验
		750 = { change_variable = { which = sxx_fairy_pop_xp value = value:sxx_fairy_pop_xp_get_t6 } } # 5倍经验
		225 = { change_variable = { which = sxx_fairy_pop_xp value = value:sxx_fairy_pop_xp_get_t7 } } # 10倍经验
		20 = { change_variable = { which = sxx_fairy_pop_xp value = value:sxx_fairy_pop_xp_get_t8 } } # 50倍经验
		5 = { change_variable = { which = sxx_fairy_pop_xp value = value:sxx_fairy_pop_xp_get_t9 } } # 100倍经验
	}
	sxx_set_fairy_pop_xp_max_if_over_max = yes
}

sxx_planet_cultivate_effect = {
	optimize_memory
	set_update_modifiers_batch = begin
	switch = {
		trigger = has_global_flag
		sxx_break_level_1 = {
			every_owned_pop = {
				limit = {
					is_sxx_cultivable_cultivator = yes
					is_sxx_fairy_pop = no
				}
				if = {
					limit = {
						check_variable = {
							which = sxx_pop_xp
							value >= value:sxx_pop_xp_max
						}
					}
					sxx_set_pop_xp_max_if_over_max = yes
					random_list = {
						5 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_die_from_cultivation_by_state CHANCE1 = 500 CHANCE2 = 500 MODIFIER = sxx_break_die_chance_upkeep_mult } }
						15 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_pd_from_cultivation_by_state CHANCE1 = 500 CHANCE2 = 500 MODIFIER = sxx_break_pd_chance_upkeep_mult } }
						80 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_break_from_cultivation_by_state CHANCE1 = 300 CHANCE2 = 700 MODIFIER = sxx_break_success_chance_produces_mult } }
					}
				}
				else = {
					random_list = {
						500 = { sxx_chance_happen_effect_2 = { EFFECT1 = sxx_pop_may_die_from_cultivation EFFECT2 = sxx_pop_random_get_xp CHANCE1 = 50 CHANCE2 = 950 MODIFIER = sxx_normal_die_chance_upkeep_mult } } # 死亡
						5000 = { sxx_chance_happen_effect_2 = { EFFECT1 = sxx_pop_may_pd_from_cultivation EFFECT2 = sxx_pop_random_get_xp CHANCE1 = 50 CHANCE2 = 950 MODIFIER = sxx_normal_pd_chance_upkeep_mult } } # 潜力耗尽
						94500 = { sxx_pop_random_get_xp = yes }
					}
				}
			}
		}
		sxx_break_level_2 = {
			every_owned_pop = {
				limit = {
					is_sxx_cultivable_cultivator = yes
					is_sxx_fairy_pop = no
				}
				if = {
					limit = {
						check_variable = {
							which = sxx_pop_xp
							value >= value:sxx_pop_xp_max
						}
					}
					sxx_set_pop_xp_max_if_over_max = yes
					random_list = {
						10 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_die_from_cultivation_by_state CHANCE1 = 500 CHANCE2 = 500 MODIFIER = sxx_break_die_chance_upkeep_mult } }
						30 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_pd_from_cultivation_by_state CHANCE1 = 500 CHANCE2 = 500 MODIFIER = sxx_break_pd_chance_upkeep_mult } }
						60 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_break_from_cultivation_by_state CHANCE1 = 300 CHANCE2 = 700 MODIFIER = sxx_break_success_chance_produces_mult } }
					}
				}
				else = {
					random_list = {
						500 = { sxx_chance_happen_effect_2 = { EFFECT1 = sxx_pop_may_die_from_cultivation EFFECT2 = sxx_pop_random_get_xp CHANCE1 = 50 CHANCE2 = 950 MODIFIER = sxx_normal_die_chance_upkeep_mult } } # 死亡
						5000 = { sxx_chance_happen_effect_2 = { EFFECT1 = sxx_pop_may_pd_from_cultivation EFFECT2 = sxx_pop_random_get_xp CHANCE1 = 50 CHANCE2 = 950 MODIFIER = sxx_normal_pd_chance_upkeep_mult } } # 潜力耗尽
						94500 = { sxx_pop_random_get_xp = yes }
					}
				}
			}
		}
		sxx_break_level_3 = {
			every_owned_pop = {
				limit = {
					is_sxx_cultivable_cultivator = yes
					is_sxx_fairy_pop = no
				}
				if = {
					limit = {
						check_variable = {
							which = sxx_pop_xp
							value >= value:sxx_pop_xp_max
						}
					}
					sxx_set_pop_xp_max_if_over_max = yes
					random_list = {
						15 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_die_from_cultivation_by_state CHANCE1 = 500 CHANCE2 = 500 MODIFIER = sxx_break_die_chance_upkeep_mult } }
						45 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_pd_from_cultivation_by_state CHANCE1 = 500 CHANCE2 = 500 MODIFIER = sxx_break_pd_chance_upkeep_mult } }
						40 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_break_from_cultivation_by_state CHANCE1 = 300 CHANCE2 = 700 MODIFIER = sxx_break_success_chance_produces_mult } }
					}
				}
				else = {
					random_list = {
						500 = { sxx_chance_happen_effect_2 = { EFFECT1 = sxx_pop_may_die_from_cultivation EFFECT2 = sxx_pop_random_get_xp CHANCE1 = 50 CHANCE2 = 950 MODIFIER = sxx_normal_die_chance_upkeep_mult } } # 死亡
						5000 = { sxx_chance_happen_effect_2 = { EFFECT1 = sxx_pop_may_pd_from_cultivation EFFECT2 = sxx_pop_random_get_xp CHANCE1 = 50 CHANCE2 = 950 MODIFIER = sxx_normal_pd_chance_upkeep_mult } } # 潜力耗尽
						94500 = { sxx_pop_random_get_xp = yes }
					}
				}
			}
		}
		sxx_break_level_4 = {
			every_owned_pop = {
				limit = {
					is_sxx_cultivable_cultivator = yes
					is_sxx_fairy_pop = no
				}
				if = {
					limit = {
						check_variable = {
							which = sxx_pop_xp
							value >= value:sxx_pop_xp_max
						}
					}
					sxx_set_pop_xp_max_if_over_max = yes
					random_list = {
						20 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_die_from_cultivation_by_state CHANCE1 = 500 CHANCE2 = 500 MODIFIER = sxx_break_die_chance_upkeep_mult } }
						60 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_pd_from_cultivation_by_state CHANCE1 = 500 CHANCE2 = 500 MODIFIER = sxx_break_pd_chance_upkeep_mult } }
						20 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_break_from_cultivation_by_state CHANCE1 = 300 CHANCE2 = 700 MODIFIER = sxx_break_success_chance_produces_mult } }
					}
				}
				else = {
					random_list = {
						500 = { sxx_chance_happen_effect_2 = { EFFECT1 = sxx_pop_may_die_from_cultivation EFFECT2 = sxx_pop_random_get_xp CHANCE1 = 50 CHANCE2 = 950 MODIFIER = sxx_normal_die_chance_upkeep_mult } } # 死亡
						5000 = { sxx_chance_happen_effect_2 = { EFFECT1 = sxx_pop_may_pd_from_cultivation EFFECT2 = sxx_pop_random_get_xp CHANCE1 = 50 CHANCE2 = 950 MODIFIER = sxx_normal_pd_chance_upkeep_mult } } # 潜力耗尽
						94500 = { sxx_pop_random_get_xp = yes }
					}
				}
			}
		}
		default = {
			every_owned_pop = {
				limit = {
					is_sxx_cultivable_cultivator = yes
					is_sxx_fairy_pop = no
				}
				if = {
					limit = {
						check_variable = {
							which = sxx_pop_xp
							value >= value:sxx_pop_xp_max
						}
					}
					sxx_set_pop_xp_max_if_over_max = yes
					random_list = {
						10 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_die_from_cultivation_by_state CHANCE1 = 500 CHANCE2 = 500 MODIFIER = sxx_break_die_chance_upkeep_mult } }
						30 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_pd_from_cultivation_by_state CHANCE1 = 500 CHANCE2 = 500 MODIFIER = sxx_break_pd_chance_upkeep_mult } }
						60 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_break_from_cultivation_by_state CHANCE1 = 300 CHANCE2 = 700 MODIFIER = sxx_break_success_chance_produces_mult } }
					}
				}
				else = {
					random_list = {
						500 = { sxx_chance_happen_effect_2 = { EFFECT1 = sxx_pop_may_die_from_cultivation EFFECT2 = sxx_pop_random_get_xp CHANCE1 = 50 CHANCE2 = 950 MODIFIER = sxx_normal_die_chance_upkeep_mult } } # 死亡
						5000 = { sxx_chance_happen_effect_2 = { EFFECT1 = sxx_pop_may_pd_from_cultivation EFFECT2 = sxx_pop_random_get_xp CHANCE1 = 50 CHANCE2 = 950 MODIFIER = sxx_normal_pd_chance_upkeep_mult } } # 潜力耗尽
						94500 = { sxx_pop_random_get_xp = yes }
					}
				}
			}
		}
	}
	set_update_modifiers_batch = end
}

sxx_planet_cultivate_except_dujie_effect = {
	optimize_memory
	set_update_modifiers_batch = begin
	switch = {
		trigger = has_global_flag
		sxx_break_level_1 = {
			every_owned_pop = {
				limit = {
					is_sxx_cultivable_cultivator = yes
					NOT = { has_pop_flag = sxx_dujie }
					is_sxx_fairy_pop = no
				}
				if = {
					limit = {
						check_variable = {
							which = sxx_pop_xp
							value >= value:sxx_pop_xp_max
						}
					}
					sxx_set_pop_xp_max_if_over_max = yes
					random_list = {
						5 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_die_from_cultivation_by_state CHANCE1 = 500 CHANCE2 = 500 MODIFIER = sxx_break_die_chance_upkeep_mult } }
						15 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_pd_from_cultivation_by_state CHANCE1 = 500 CHANCE2 = 500 MODIFIER = sxx_break_pd_chance_upkeep_mult } }
						80 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_break_from_cultivation_by_state CHANCE1 = 300 CHANCE2 = 700 MODIFIER = sxx_break_success_chance_produces_mult } }
					}
				}
				else = {
					random_list = {
						500 = { sxx_chance_happen_effect_2 = { EFFECT1 = sxx_pop_may_die_from_cultivation EFFECT2 = sxx_pop_random_get_xp CHANCE1 = 50 CHANCE2 = 950 MODIFIER = sxx_normal_die_chance_upkeep_mult } } # 死亡
						5000 = { sxx_chance_happen_effect_2 = { EFFECT1 = sxx_pop_may_pd_from_cultivation EFFECT2 = sxx_pop_random_get_xp CHANCE1 = 50 CHANCE2 = 950 MODIFIER = sxx_normal_pd_chance_upkeep_mult } } # 潜力耗尽
						94500 = { sxx_pop_random_get_xp = yes }
					}
				}
			}
		}
		sxx_break_level_2 = {
			every_owned_pop = {
				limit = {
					is_sxx_cultivable_cultivator = yes
					NOT = { has_pop_flag = sxx_dujie }
				}
				if = {
					limit = {
						check_variable = {
							which = sxx_pop_xp
							value >= value:sxx_pop_xp_max
						}
					}
					sxx_set_pop_xp_max_if_over_max = yes
					random_list = {
						10 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_die_from_cultivation_by_state CHANCE1 = 500 CHANCE2 = 500 MODIFIER = sxx_break_die_chance_upkeep_mult } }
						30 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_pd_from_cultivation_by_state CHANCE1 = 500 CHANCE2 = 500 MODIFIER = sxx_break_pd_chance_upkeep_mult } }
						60 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_break_from_cultivation_by_state CHANCE1 = 300 CHANCE2 = 700 MODIFIER = sxx_break_success_chance_produces_mult } }
					}
				}
				else = {
					random_list = {
						500 = { sxx_chance_happen_effect_2 = { EFFECT1 = sxx_pop_may_die_from_cultivation EFFECT2 = sxx_pop_random_get_xp CHANCE1 = 50 CHANCE2 = 950 MODIFIER = sxx_normal_die_chance_upkeep_mult } } # 死亡
						5000 = { sxx_chance_happen_effect_2 = { EFFECT1 = sxx_pop_may_pd_from_cultivation EFFECT2 = sxx_pop_random_get_xp CHANCE1 = 50 CHANCE2 = 950 MODIFIER = sxx_normal_pd_chance_upkeep_mult } } # 潜力耗尽
						94500 = { sxx_pop_random_get_xp = yes }
					}
				}
			}
		}
		sxx_break_level_3 = {
			every_owned_pop = {
				limit = {
					is_sxx_cultivable_cultivator = yes
					NOT = { has_pop_flag = sxx_dujie }
				}
				if = {
					limit = {
						check_variable = {
							which = sxx_pop_xp
							value >= value:sxx_pop_xp_max
						}
					}
					sxx_set_pop_xp_max_if_over_max = yes
					random_list = {
						15 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_die_from_cultivation_by_state CHANCE1 = 500 CHANCE2 = 500 MODIFIER = sxx_break_die_chance_upkeep_mult } }
						45 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_pd_from_cultivation_by_state CHANCE1 = 500 CHANCE2 = 500 MODIFIER = sxx_break_pd_chance_upkeep_mult } }
						40 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_break_from_cultivation_by_state CHANCE1 = 300 CHANCE2 = 700 MODIFIER = sxx_break_success_chance_produces_mult } }
					}
				}
				else = {
					random_list = {
						500 = { sxx_chance_happen_effect_2 = { EFFECT1 = sxx_pop_may_die_from_cultivation EFFECT2 = sxx_pop_random_get_xp CHANCE1 = 50 CHANCE2 = 950 MODIFIER = sxx_normal_die_chance_upkeep_mult } } # 死亡
						5000 = { sxx_chance_happen_effect_2 = { EFFECT1 = sxx_pop_may_pd_from_cultivation EFFECT2 = sxx_pop_random_get_xp CHANCE1 = 50 CHANCE2 = 950 MODIFIER = sxx_normal_pd_chance_upkeep_mult } } # 潜力耗尽
						94500 = { sxx_pop_random_get_xp = yes }
					}
				}
			}
		}
		sxx_break_level_4 = {
			every_owned_pop = {
				limit = {
					is_sxx_cultivable_cultivator = yes
					NOT = { has_pop_flag = sxx_dujie }
				}
				if = {
					limit = {
						check_variable = {
							which = sxx_pop_xp
							value >= value:sxx_pop_xp_max
						}
					}
					sxx_set_pop_xp_max_if_over_max = yes
					random_list = {
						20 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_die_from_cultivation_by_state CHANCE1 = 500 CHANCE2 = 500 MODIFIER = sxx_break_die_chance_upkeep_mult } }
						60 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_pd_from_cultivation_by_state CHANCE1 = 500 CHANCE2 = 500 MODIFIER = sxx_break_pd_chance_upkeep_mult } }
						20 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_break_from_cultivation_by_state CHANCE1 = 300 CHANCE2 = 700 MODIFIER = sxx_break_success_chance_produces_mult } }
					}
				}
				else = {
					random_list = {
						500 = { sxx_chance_happen_effect_2 = { EFFECT1 = sxx_pop_may_die_from_cultivation EFFECT2 = sxx_pop_random_get_xp CHANCE1 = 50 CHANCE2 = 950 MODIFIER = sxx_normal_die_chance_upkeep_mult } } # 死亡
						5000 = { sxx_chance_happen_effect_2 = { EFFECT1 = sxx_pop_may_pd_from_cultivation EFFECT2 = sxx_pop_random_get_xp CHANCE1 = 50 CHANCE2 = 950 MODIFIER = sxx_normal_pd_chance_upkeep_mult } } # 潜力耗尽
						94500 = { sxx_pop_random_get_xp = yes }
					}
				}
			}
		}
		default = {
			every_owned_pop = {
				limit = {
					is_sxx_cultivable_cultivator = yes
					NOT = { has_pop_flag = sxx_dujie }
				}
				if = {
					limit = {
						check_variable = {
							which = sxx_pop_xp
							value >= value:sxx_pop_xp_max
						}
					}
					sxx_set_pop_xp_max_if_over_max = yes
					random_list = {
						10 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_die_from_cultivation_by_state CHANCE1 = 500 CHANCE2 = 500 MODIFIER = sxx_break_die_chance_upkeep_mult } }
						30 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_pd_from_cultivation_by_state CHANCE1 = 500 CHANCE2 = 500 MODIFIER = sxx_break_pd_chance_upkeep_mult } }
						60 = { sxx_chance_happen_effect = { EFFECT = sxx_pop_may_break_from_cultivation_by_state CHANCE1 = 300 CHANCE2 = 700 MODIFIER = sxx_break_success_chance_produces_mult } }
					}
				}
				else = {
					random_list = {
						500 = { sxx_chance_happen_effect_2 = { EFFECT1 = sxx_pop_may_die_from_cultivation EFFECT2 = sxx_pop_random_get_xp CHANCE1 = 50 CHANCE2 = 950 MODIFIER = sxx_normal_die_chance_upkeep_mult } } # 死亡
						5000 = { sxx_chance_happen_effect_2 = { EFFECT1 = sxx_pop_may_pd_from_cultivation EFFECT2 = sxx_pop_random_get_xp CHANCE1 = 50 CHANCE2 = 950 MODIFIER = sxx_normal_pd_chance_upkeep_mult } } # 潜力耗尽
						94500 = { sxx_pop_random_get_xp = yes }
					}
				}
			}
		}
	}
	set_update_modifiers_batch = end
}

sxx_planet_fairy_cultivate_effect = {
	optimize_memory
	set_update_modifiers_batch = begin
	switch = {
		trigger = has_global_flag
		sxx_break_level_1 = {
			every_owned_pop = {
				limit = {
					is_sxx_fairy_pop = yes
					is_sxx_cultivable_cultivator = yes
				}
				if = {
					limit = {
						check_variable = {
							which = sxx_fairy_pop_xp
							value >= value:sxx_fairy_pop_xp_max
						}
					}
					sxx_set_fairy_pop_xp_max_if_over_max = yes
					random_list = {
						60 = {}
						40 = { sxx_fairy_pop_may_break_from_cultivation_by_state = yes }
					}
				}
				else = {
					sxx_fairy_pop_random_get_xp = yes
				}
			}
		}
		sxx_break_level_2 = {
			every_owned_pop = {
				limit = {
					is_sxx_fairy_pop = yes
					is_sxx_cultivable_cultivator = yes
				}
				if = {
					limit = {
						check_variable = {
							which = sxx_fairy_pop_xp
							value >= value:sxx_fairy_pop_xp_max
						}
					}
					sxx_set_fairy_pop_xp_max_if_over_max = yes
					random_list = {
						70 = {}
						30 = { sxx_fairy_pop_may_break_from_cultivation_by_state = yes }
					}
				}
				else = {
					sxx_fairy_pop_random_get_xp = yes
				}
			}
		}
		sxx_break_level_3 = {
			every_owned_pop = {
				limit = {
					is_sxx_fairy_pop = yes
					is_sxx_cultivable_cultivator = yes
				}
				if = {
					limit = {
						check_variable = {
							which = sxx_fairy_pop_xp
							value >= value:sxx_fairy_pop_xp_max
						}
					}
					sxx_set_fairy_pop_xp_max_if_over_max = yes
					random_list = {
						80 = {}
						20 = { sxx_fairy_pop_may_break_from_cultivation_by_state = yes }
					}
				}
				else = {
					sxx_fairy_pop_random_get_xp = yes
				}
			}
		}
		sxx_break_level_4 = {
			every_owned_pop = {
				limit = {
					is_sxx_fairy_pop = yes
					is_sxx_cultivable_cultivator = yes
				}
				if = {
					limit = {
						check_variable = {
							which = sxx_fairy_pop_xp
							value >= value:sxx_fairy_pop_xp_max
						}
					}
					sxx_set_fairy_pop_xp_max_if_over_max = yes
					random_list = {
						90 = {}
						10 = { sxx_fairy_pop_may_break_from_cultivation_by_state = yes }
					}
				}
				else = {
					sxx_fairy_pop_random_get_xp = yes
				}
			}
		}
		default = {
			every_owned_pop = {
				limit = {
					is_sxx_fairy_pop = yes
					is_sxx_cultivable_cultivator = yes
				}
				if = {
					limit = {
						check_variable = {
							which = sxx_fairy_pop_xp
							value >= value:sxx_fairy_pop_xp_max
						}
					}
					sxx_set_fairy_pop_xp_max_if_over_max = yes
					random_list = {
						70 = {}
						30 = { sxx_fairy_pop_may_break_from_cultivation_by_state = yes }
					}
				}
				else = {
					sxx_fairy_pop_random_get_xp = yes
				}
			}
		}
	}
	set_update_modifiers_batch = end
}

sxx_fairy_pop_may_sleep = {
	if = {
		limit = {
			owner = { is_ai = yes }
		}
		random_list = {
			1 = {
				modifier = {
					add = owner.num_sxx_xianwang
				}
				random_list = {
					10 = {
						modifier = {
							add = 10
							planet = { NOT = { is_planet_class = pc_sxx_heaven } }
						}
						modifier = {
							add = 10
							has_job = sxx_other_fairy
						}
						owner = {
							country_event = { id = sxx_fairy.140 }
						}
						event_target:sxx_heaven_planet = { add_deposit = d_sxx_sleep_fairy }
						kill_pop = yes
					}
					90 = {
						modifier = {
							subtract = 10
							planet = { NOT = { is_planet_class = pc_sxx_heaven } }
						}
						modifier = {
							subtract = 10
							has_job = sxx_other_fairy
						}
					}
				}
			}
			9 = {
				modifier = {
					subtract = owner.num_sxx_xianwang
				}
			}
		}
	}
}

sxx_fairy_may_sleep_effect = {
	if = {
		limit = {
			any_owned_planet = {
				is_planet_class = pc_sxx_heaven
			}
		}
		random_owned_planet = {
			limit = {
				is_planet_class = pc_sxx_heaven
			}
			save_event_target_as = sxx_heaven_planet
		}
		switch = {
			trigger = has_global_flag
			sxx_break_level_1 = {
				every_owned_pop = {
					limit = {
						has_pop_flag = sxx_zhenxian
						is_sxx_cultivable_cultivator = yes
						NOT = { has_job = sxx_sealer }
					}
					random_list = {
						1 = { sxx_fairy_pop_may_sleep = yes }
						99 = {}
					}
				}
			}
			sxx_break_level_2 = {
				every_owned_pop = {
					limit = {
						has_pop_flag = sxx_zhenxian
						is_sxx_cultivable_cultivator = yes
						NOT = { has_job = sxx_sealer }
					}
					random_list = {
						2 = { sxx_fairy_pop_may_sleep = yes }
						98 = {}
					}
				}
			}
			sxx_break_level_3 = {
				every_owned_pop = {
					limit = {
						has_pop_flag = sxx_zhenxian
						is_sxx_cultivable_cultivator = yes
						NOT = { has_job = sxx_sealer }
					}
					random_list = {
						3 = { sxx_fairy_pop_may_sleep = yes }
						97 = {}
					}
				}
			}
			sxx_break_level_4 = {
				every_owned_pop = {
					limit = {
						has_pop_flag = sxx_zhenxian
						is_sxx_cultivable_cultivator = yes
						NOT = { has_job = sxx_sealer }
					}
					random_list = {
						4 = { sxx_fairy_pop_may_sleep = yes }
						96 = {}
					}
				}
			}
			default = {
				every_owned_pop = {
					limit = {
						has_pop_flag = sxx_zhenxian
						is_sxx_cultivable_cultivator = yes
						NOT = { has_job = sxx_sealer }
					}
					random_list = {
						2 = { sxx_fairy_pop_may_sleep = yes }
						98 = {}
					}
				}
			}
		}
	}
}

sxx_planet_kuilei_upgrade_effect = {
	if = { # 傀儡升级
		limit = {
			owner = { has_valid_civic = civic_sxx_kuilei }
			has_modifier = sxx_kuilei_upgrading_modifier
		}
		while = {
			count = value:sxx_planet_kuilei_assembly_value_round
			random_owned_pop = {
				limit = {
					sxx_pop_is_robot_can_be_upgraded = yes
				}
				weights = {
					base = 1
					modifier = {
						add = 9
						is_sxx_potential_depletion = yes
					}
					modifier = {
						add = 99
						check_variable = {
							which = sxx_pop_xp
							value >= value:sxx_pop_xp_max
						}
					}
				}
				if = {
					limit = {
						is_sxx_potential_depletion = yes
					}
					sxx_pop_remove_potential_depletion = yes
				}
				else_if = {
					limit = {
						check_variable = {
							which = sxx_pop_xp
							value >= value:sxx_pop_xp_max
						}
					}
					switch = {
						trigger = has_pop_flag
						sxx_lianqi = { sxx_pop_break_to_zhuji = yes }
						sxx_zhuji = { sxx_pop_break_to_jindan = yes }
						sxx_jindan = { sxx_pop_break_to_yuanying = yes }
						sxx_yuanying = { sxx_pop_break_to_huashen = yes }
						sxx_huashen = { sxx_pop_break_to_lianxu = yes }
						sxx_lianxu = { sxx_pop_break_to_heti = yes }
						sxx_heti = { sxx_pop_break_to_dacheng = yes }
						sxx_dacheng = { sxx_pop_break_to_dujie = yes }
					}
				}
				else = {
					change_variable = {
						which = sxx_pop_xp
						value = planet.value:sxx_planet_kuilei_upgrade_xp_add
					}
					sxx_set_pop_xp_max_if_over_max = yes
				}
			}
		}
	}
}

sxx_planet_luding_may_down_state_effect = {
	if = {
		limit = {
			root = { has_policy_flag = sxx_luding_not_cultivable }
			any_owned_pop = { has_job = sxx_luding }
		}
		every_owned_pop = { # 炉鼎跌落境界
			limit = {
				has_job = sxx_luding
			}
			random_list = {
				5 = {
					if = {
						limit = {
							is_sxx_potential_depletion = yes
						}
						sxx_pop_down_state = yes
					}
					else = {
						sxx_pop_set_potential_depletion = yes
					}
				}
				95 = {}
			}
		}
	}
}